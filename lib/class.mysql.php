<?php
/**
 * 
 * mysql类
 * @author CHEN041
 *
 */
class mysql {	var $link;	var $querynum = 0;	function connect($host,$user,$pwd,$dbname,$pconnect = FALSE) {		if ($pconnect) {			if (!$this->link = @mysql_pconnect($host,$user,$pwd)) {				$this->halt('数据库连接失败！');			}		} else {			if (!$this->link = @mysql_connect($host,$user,$pwd)) {				$this->halt('数据库连接失败！');			}		}		if (!mysql_select_db($dbname)) {			$this->halt('无法打开数据库！');		}	}	function query($sql) {		if (!$query = mysql_query($sql,$this->link)) {			$this->halt('查询失败！',$sql);		}		$this->querynum ++;		return $query;	}	function fetch_array($query,$result_type=2) {		//MYSQL_ASSOC 0-MYSQL_BOTH		$result=$result_type==1?MYSQL_BOTH:MYSQL_ASSOC;		return mysql_fetch_array($query,$result);	}	function fetch_all($sql,$type=1) {		$result = array();		$query = $this->query($sql);		while($row = $this->fetch_array($query,$type)) {			$result[] = $row;		}		return $result;	}	function result ($sql, $row = 0) {		$query = $this->query($sql);		return mysql_result($query, $row);	}	function free_result($query) {		return mysql_free_result($query);	}	function fetch_one_array($sql) {		$query = $this->query($sql);		return $this->fetch_array($query);	}	function insert_id() {		return ($id = mysql_insert_id($this->link)) >= 0 ? $id : $this->result($this->query("SELECT last_insert_id()"), 0);	}	function num_rows($query) {		return mysql_num_rows($query);	}	function affected_rows() {		return mysql_affected_rows($this->link);	}	function close() {		return mysql_close($this->link);	}	function version() {		return mysql_get_server_info($this->link);	}	function halt($msg = '',$sql = '') {		$output = '<div style="font-size:11px;font-family:Verdana">msg:'.$msg.'<br />sql:'.$sql.'<br />errno:'.mysql_errno().'<br />error:'.mysql_error().'</div>';		exit($output);	}}?>